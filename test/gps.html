<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="text/javascript" src="../lib/jquery-1.8.2.min.js"></script>
<script type="text/javascript" src="../lib/lat.js"></script>
<script type="text/javascript">

    var theResultCitys={};
    //var theIndex=0;
    var theCityNames=[];
    function getLocation() {

        for (var name in theCitys) {
            theCityNames.push(name);
            //debugger;



        }
        getItem(0);
        console.log(theResultCitys);
    }

    function getItem(index){
        if(index>theCityNames.length){
            console.log(JSON.stringify(theResultCitys));
            return;
        }
        var theData = "http://api.map.baidu.com/geocoder/v2/?address=${name}&output=json&ak=uhUXo95zcpPPzkt8hxbB8URBe60heVA1";
        var name=theCityNames[index];
        var theUrl = eval('`'+theData+'`');
        console.log(theUrl);
        $.ajax({
            type: "get",
            async: false,
            url: theUrl,
            dataType: "jsonp",
            jsonp: "callback",//传递给请求处理程序或页面的，用以获得jsonp回调函数名的参数名(一般默认为:callback)
            jsonpCallback:"showLocation",//自定义的jsonp回调函数名称，默认为jQuery自动生成的随机函数名，也可以写"?"，jQuery会自动为你处理数据
            success: function(json){
                if(json.result&&json.result.location){
                    theResultCitys[name]=[json.result.location.lng,json.result.location.lat];
                    //getItem(index+1);
                }
                else{
                    console.log("未获取到地址:"+name);
                }
                getItem(index+1);
                //debugger;
            },
            error: function(){
                //alert('fail');
                console.log("发生错误"+name);

            }
        });
    }

    getLocation();
</script>
</body>
</html>